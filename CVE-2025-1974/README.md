# CVE-2025-1974
> 화이트햇 스쿨 3기 - [김소은 (@salt318)] (https://github.com/salt318/kr-vulhub)

### 요약

- 쿠버네티스의 핵심 보안 메커니즘인 Ingress-NGINX Admission Controller의 결함으로 인해 발생
- Ingress-NGINX Admission Controller는 인증 없이 네트워크에 노출된다는 문제 존재
- 이로 인해 공격자가 악성 AdmissionReview 요청을 조작하여 Ingress 리소스에 무단 구성을 삽입할 수 있음
- 다른 취약점과 연계될 경우 원격 코드 실행 가능 (CVE-2025-24514, CVE-2025-1097 또는 CVE-2025-1098)


### 환경 구성 및 실행

1. **Docker Compose로 Kubernetes 환경 실행**:
   - `docker compose up -d` 명령어로 K3s 기반의 **Kubernetes 클러스터** 환경을 구성
   - 이 환경은 테스트 용도로 사용되며, 이 안에서 **Ingress-Nginx** 컨트롤러를 실행

2. **악성 쉘 코드 컴파일**:
   - `gcc -shared -fPIC -o shell.so shell.c` 명령어로 **악성 쉘 코드**를 컴파일
   - `shell.c` 코드에서는 `__attribute__((constructor))`로 **컨스트럭터 함수**를 정의
   - 해당 코드가 실행될 때 `/tmp/hacked`라는 파일을 생성
     ```c
     #include<stdio.h>
     #include<stdlib.h>
     _attribute__((constructor)) static void reverse_shell(void)
     {
      system("touch /tmp/hacked");
     }
     ```
     ![CVE-2025-1974](https://github.com/salt318/kr-vulhub/blob/main/CVE-2025-1974/CVE-2025-1974_1.png)
3. **악성 쉘 코드 전송**:
   - 아래의 명령어를 통해, exploit.py 스크립트를 실행
     ```
     python exploit.py -a https://localhost:30443/networking/v1/ingresses -i http://localhost:30080/fake/addr -s shell.so
     ```
   - a는 Admission Webhook의 URL을, -i는 Ingress URL을, -s는 악성 쉘 파일 (shell.so)을 전달
   - 이 과정에서 공격자는 Admission Webhook을 악용하여 Kubernetes 클러스터에 악성 코드를 삽입하려고 시도
     ![CVE-2025-1974](https://github.com/salt318/kr-vulhub/blob/main/CVE-2025-1974/CVE-2025-1974_2.png)

4. **Admission Webhook 브루트포스 공격**:
   - xploit.py는 Admission Webhook을 대상으로 브루트포싱을 시도
   - Ingress 리소스를 생성하는 과정에서, /proc/{pid}/fd/{fd} 경로를 반복적으로 요청하여 웹훅을 악용
   - 악성 Ingress 리소스를 Kubernetes 클러스터에 삽입.
   - 이 과정에서 쉘 코드 파일을 포함한 요청이 Admission Controller에 전송되며, 이를 통해 시스템에 악성 쉘이 삽입 가능
     ![CVE-2025-1974](https://github.com/salt318/kr-vulhub/blob/main/CVE-2025-1974/CVE-2025-1974_2.png)

### 실행 결과
![CVE-2025-1974](https://github.com/salt318/kr-vulhub/blob/main/CVE-2025-1974/CVE-2025-1974_3.png)

### 정리
Ingress-NGINX Admission Controller의 인증 부재 취약점은 악성 Ingress 리소스를 삽입하거나 시스템을 제어하는 행위를 가능하게 하며, 다른 취약점과 연계될 경우 원격 코드 실행(RCE)로 이어질 수 있다. 따라서 Admission Controller 접근에 대한 인증 및 권한 검증 강화, Ingress 리소스 검증 로직 강화, 네트워크 ACL(Access Control List) 설정을 통한 외부 접근 차단 등의 보안 조치를 적용해야 한다.
